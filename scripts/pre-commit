#!/bin/sh

set -v

add () {
	FAILED="$(echo "$FAILED + $1" | bc)"
}

FAILED=0
IGNORED=$(echo '
http://www.verteiltesysteme.net/r/a,
http://www.verteiltesysteme.net/r/b,
http://prefetch.validatorsearch.verisignlabs.com,
https://www.linkedin.com/in/joshuayn,
http://localhost:4000
' | tr -d '\n')

bundle exec jekyll build

# does NOT currently exit with errors
# travis doesn't recognize apt: for some reason
cd "$(git rev-parse --show-toplevel)"
travis lint --skip-completion-check
add $?

# Linkedin blocks robots
bundle exec htmlproofer \
	--url-ignore $IGNORED \
	_site ./_site
add $?

linklint -error -warn -net -root ./_site /@
add $?

if [ "$FAILED" -ne 0 ] ; then
	echo "Commit had $FAILED errors"
else
	echo "Commit succeeded"
fi

exit $FAILED

